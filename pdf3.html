<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <title>PDF example</title>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.1.0/exif.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-load-image/2.12.2/load-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-load-image/2.12.2/load-image-scale.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-load-image/2.12.2/load-image-orientation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>


    <style> 

    #container {
        position: relative;
        width: AUTO;
        max-height: auto;

        
    }
    #thumb {
        display:inline-block;
          }

    #thumb.rotate90,
    #thumb.rotate270 {
        display:inline-block;
            
        }
    </style>    

</head>

<body>
    
    <input type="file" name="file" id="upload">
    <input type="button" id="button" value="회전">
    <input type="button" id="create_pdf" value="PDF생성">
    
    <hr>

    <div id="container1">
        <h1>물품확인서(종합연구동 113호, 농업회사법인 (주)푸드베리)</h1>
        <h3>
            캐비닛<br><br><br><br><br><br><br><br><br><br><br>
            0861<br><br><br><br>0900<br><br><br>056256<br><br><br><br>058
        
            의자<br><br><br><br><br><br>
            07013040<br><br><br><br><br><br><br>0043236658
            노트<br><br><br>북컴퓨터, HP, CN/ProB<br><br><br>ook 45<br><br><br>0 G3J94PA, Intel Core i5 4200M(2.5GHz)
            08409<br><br><br><br>000495<br><br>03769
        </h3>
    </div> 

    <div id="container2">
        <div id="thumb" ></div>
    </div>


    <script>
    
    //회전 함수
    var angle = 0;
    $('#button').on('click', function() {	
        angle += 90;
        $('#thumb').css('transform','rotate(' + angle % 360 + 'deg)');
    });


    //스마트폰 사진 업로드시 회전 방지
    document.getElementById('upload').onchange = function (e) {
        var image = e.target.files[0];
        window.loadImage(image, function (img) {
                window.EXIF.getData(image, function () {
                    var orientation = window.EXIF.getTag(this, "Orientation");
                    var canvas = window.loadImage.scale(img,
                        {orientation: orientation || 0, canvas: true, maxWidth: 300, maxheight: 300});
                    document.getElementById("thumb").appendChild(canvas);
             });    
        });
    };

    //PDF 생성 함수
    $('#create_pdf').click(function() {


        //div를 canvas객체로 변환
        html2canvas($('#container')[0]).then(function(canvas) {          
            var imgData = canvas.toDataURL('image/png');
            var imgWidth = 210; 
            var pageHeight = 295; 
            var imgHeight = canvas.height * imgWidth / canvas.width; 
            var heightLeft = imgHeight;
            var doc = new jsPDF('p', 'mm');
            var position = 0; 
            
            doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight); 
            heightLeft -= pageHeight; 
            
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                doc.addPage(); 
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight); 
                heightLeft -= pageHeight; 
            }


            doc.addPage();
            doc.addImage(imgData2, 'PNG', 0, position, imgWidth, imgHeight); 
            heightLeft = imgHeight2;

            doc.save('test.pdf');
     });
    });

    </script>

</body>
</html>